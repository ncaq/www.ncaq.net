---
title: Immutable.js 4.0.0-rc.9はFlowでもTypeScriptでもgetとsetの文字列を検査してエラーを出します
---

[Immutable.js](https://facebook.github.io/immutable-js/)のRecordについて情報を察知しました.

class extendでRecordを継承して独自の型を作るやつです.

生JavaScript版,型安全も何もない.

~~~js
const { Record } = require("immutable");

class Person extends Record({ name: "", birthday: null }) {
  get age() {
    return new Date().getFullYear() - this.birthday.getFullYear();
  }
  年齢偽装() {
    return this.set("birthday", new Date("1950-01-01"));
  }
}

const ncaq = new Person({ name: "ncaq", birthday: new Date("1996-01-25") });

console.log(ncaq);
console.log(ncaq.name);
console.log(ncaq.set("name", "エヌユル"));
console.log(ncaq.age);
console.log(ncaq.年齢偽装());
~~~

実行結果

~~~text
Person { name: "ncaq", birthday: Thu Jan 25 1996 09:00:00 GMT+0900 (JST) }
ncaq
Person { name: "エヌユル", birthday: Thu Jan 25 1996 09:00:00 GMT+0900 (JST) }
22
Person { name: "ncaq", birthday: Sun Jan 01 1950 09:00:00 GMT+0900 (JST) }
~~~

Flow版

Flow版はプロパティアクセスが使えません.
なので`get`メソッドを使ってアクセスすることになります.
文字列を間違えるとエラーが出ます.
Flowを使うの初めてだったので,birthdayの初期値を設定しないでコンストラクト時に要求する方法がわかりませんでした.

~~~js
// @flow

import { Record } from "immutable";

class Person extends Record({ name: "", birthday: new Date() }) {
  get age() {
    return new Date().getFullYear() - this.get("birthday").getFullYear();
  }
  年齢偽装() {
    return this.set("birthday", new Date("1950-01-01"));
  }
}

const ncaq = new Person({ name: "ncaq", birthday: new Date("1996-01-25") });

console.log(ncaq);
console.log(ncaq.name);
console.log(ncaq.set("name", "エヌユル"));
console.log(ncaq.age);
console.log(ncaq.年齢偽装());
~~~

TypeScript版
TypeScript版はプロパティアクセスが使えます.
勿論プロパティを間違えるとエラーです.
`get`メソッドも使えますが,Flow版とインターフェイスが違い,`notSetValue`引数を指定しないと`get`できません.

~~~
import {Record} from 'immutable';

class Person extends Record({ name: "", birthday: null }) {
    get age() {
        return new Date().getFullYear() - this.birthday.getFullYear();
    }
    年齢偽装() {
        return this.set("birthday", new Date("1950-01-01"));
    }
}

const ncaq = new Person({ name: "ncaq", birthday: new Date("1996-01-25") });

console.log(ncaq);
console.log(ncaq.name);
console.log(ncaq.set("name", "エヌユル"));
console.log(ncaq.age);
console.log(ncaq.年齢偽装());
~~~

Immutable.js 4ではFlowでもTypeScriptでも型エラーを出してくれることがわかりました.

どちらでも`birthday`に`null`を許可しないで,初期値を設定せず,コンストラクタで設定することを要求する方法はわかりませんでした.
TypeScriptでは`class Person extends Record<{name: string, birthday: Date}>({ name: "", birthday: null })`
みたいに書けることはわかりましたが,`"strictNullChecks": true`にしたら`birthday: null`の表記に怒り出すんですよね.
これは独自のコンストラクタを設置してそこで値を要求し,デフォルト値は適当なものを入れておくしか無いのでしょうか.
使われないデフォルト値を設置するのも気が引けるのですが…
誰か教えてください.

