---
title: Rustで外部crateの型にメソッドを実装する
---

Rustにはメソッド構文があります.

[メソッド構文](https://doc.rust-jp.rs/the-rust-programming-language-ja/1.6/book/method-syntax.html)

となるとデータに関連する処理は単独関数ではなくメソッドで実装したいですね.

よし

~~~rs
type Comments = Arc<RwLock<BTreeMap<u32, String>>>;

impl Comments {
    fn lines(&self) -> Vec<String> {
        unimplemented!();
    }
}
~~~

これはエラーになります.

理由については
[Rustのコヒーレンス - 簡潔なQ](https://qnighy.hatenablog.com/entry/2017/07/20/220000)
を読みましょう.

ここでは手っ取り早く解決方法だけを書きます.

~~~rs
type Comments = Arc<RwLock<BTreeMap<u32, String>>>;

trait Lines {
    fn lines(&self) -> Vec<String>;
}

impl Lines for Comments {
    fn lines(&self) -> Vec<String> {
        unimplemented!();
    }
}
~~~

[The newtype pattern](https://doc.rust-lang.org/1.0.0/style/features/types/newtype.html)
は元の型のメソッドが使えなくなるからこちらの解決方法の方が楽ですね.
