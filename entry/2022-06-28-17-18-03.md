---
title: poetryで管理しているPythonパッケージのバージョンを一つの場所だけで定義する
---

# 問題

`pyproject.toml`の`[tool.poetry]`での`version`、
`__init__.py`での`__version__`、
FastAPIの`version`ひいてはOpenAPIでのバージョン定義をそれぞれ別に行いたくない。

別々に書き換えるのは面倒だし、
絶対に書き換え忘れのミスが生まれる。

一つの場所だけで定義して、
それをみんなが参照するようにしたい。

# 解決法

[How to get version from pyproject.toml from python app? · Issue #273 · python-poetry/poetry](https://github.com/python-poetry/poetry/issues/273)
から引用。

`pyproject.toml`はinit状態で良いとして、
それぞれの`__init__.py`は以下のようにする。

~~~py
import importlib.metadata

__version__ = importlib.metadata.version(__package__)
~~~

アプリ側でバージョンを知りたくなったら自身を`import`する。

~~~py
from . import __version__
~~~

ここで引っかかったのは、
バージョンを`pyproject.toml`を書き換える形で更新した場合前のバージョンのままになってしまうこと。
`poetry install`してデータを更新するか、
最初から`poetry version`でバージョンデータを書き換えるようにしましょう。
