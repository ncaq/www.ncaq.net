---
title: ReactでTable要素のmount(描画)に時間がかかる問題をページャを実装することで解決しました
---

# 事案

React + ReduxでTableの描画に10秒程度かかる.

要素は多くて700件ぐらい.

# やりたいこと

描画を2秒ぐらいにはしたい.

# やってたこと

* Reduxのデータ構造見直し
* Reduxのデータをなるべく更新しないようにする
* mainプロセスの処理最適化
* 階層を小さく

# 全て無駄だった

そもそもupdateではなくmountに時間がかかっているのですからやってたことは全て無駄.

更新減らすとかも無駄.

# ページャ作れば良い

Table要素はどうせ大半はファーストビューに含まれないのですから範囲外の要素は描画しなければ良い.

つまりページャを実装すれば良い.

なんか一般的に範囲外要素を描画しないミドルウェア的なものがあった気がするんですがググっても出てこない.

# 追加で操作は要求できない

ユーザ操作を必要とするものは受け入れられない.
ひっそりとシームレスに動かす必要がある.

# スクロールをイベントにする?

スクロールが最後まで来たことを感知して全て表示するように切り替えれば良いのでは?

スクロールイベント取ってスクロールの座標計算するの面倒くさい.
座標計算苦手なので絶対バグが発生する

# componentDidMountとsetTimeoutで良くない?

ファーストビューを早くしたいだけなんですから確かにそうですね.
`componentDidMount`の中で`window.setTimeout`呼んで,
`this.setState`してページャの制限を`undefined`にすることで解決.

# 得られたパフォーマンス

ファーストビューは1秒程度にはなりました.

# 本当はスクロールを取得した方が良いと思います

時間が来ると画面が一瞬ですが固まってしまいますね.

スクロールというユーザの入力に反応して次を読み込む方が直感的でユーザ体験が良さそうです.
まあ今回はそこまで作り込む必要なさそうなのでsetTimeoutで済ましてしまいますが.

# 全て無駄というほどではなかった

ページャを導入して処理が大部分じゃなくなってパフォーマンスモニタ見るようになってわかったけれど,
最適化は全て無駄というほどでは無かったようですね.

# 本当はネットワーク通信がページャに対応してるのが一番良いんです

結局ネットワーク全部読んでsortする必要があります.
リクエストでソート条件とページングを指定できるサーバAPIがあるのが理想.
フロントエンド側ではやれることが少ないですね.
