---
title: mozcをアップデートしたらmarkdown-mode限定で変換前文字列が赤くなってしまいます
---

mozcをアップデートしたらmozc.elもアップデートされたようなのですが,
これが変換前文字列の背景を真っ赤にしてきて非常にうるさく感じるようになりました.

![ひじょうにうるさい](/asset/screenshot-2017-11-07-14-20-45.png)

変換前に色を変えるのはちょっと鬱陶しいけれど問題ないのですが,
その替える先がこんな真っ赤な色では流石に目ざわりです.

まあ,
変更すれば問題ないだろうと思って,
brownを指定しているコードを探して,

~~~elisp
(set-face-background 'mozc-preedit-selected-face "#268bd2")
~~~

と書いておとなしい色になったので一見落着したと思ったのですが,
何故かmarkdown-modeでだけ変換前に赤いままで困りました.

と言うより,
加えた設定を切ってみてわかったのですが,
普通のモードの場合は変換前の入力はデフォルトで背景が透明で,
変換開始すると色が変わります.
しかし,
markdown-modeだけ変換前に赤くなってしまうんですね.

何故か途中にコードブロックを挟むと,
それ以下のカーソルではこの現象は発生しなくなります.

![コードブロック前](/asset/screenshot-2017-11-07-14-56-02.png)

![コードブロック後](/asset/screenshot-2017-11-07-14-56-18.png)

markdown-modeは非常に多機能で一万行近いファイルサイズなので,
この原因を掴むのは非常に難しいです.
そもそもmarkdown-modeが原因なのかもわからないのでバグ報告もしづらい.

まあ,
バグ報告はしないといけないな.

と思ってバグ報告しようとしたのですが,
markdown-modeの問題報告ガイドライン通りに`emacs -Q --load ~/.emacs.d/elpa/markdown-mode-20171031.1725/markdown-mode.el --load ~/.emacs.d/elpa/mozc-20160102.1506/mozc.el test.md`
してバグ報告しようとしたら再現しませんでした.

じゃあ原因はなんなのでしょう…
