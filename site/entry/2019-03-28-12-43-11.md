---
title: Btrfsã®ãƒãƒ«ãƒãƒ—ãƒ«ãƒ‡ãƒã‚¤ã‚¹ãŒsingleã ã¨JBODã«ãªã£ã¦ãƒ‡ãƒ¼ã‚¿ãŒåˆ†æ•£ã•ã‚Œãªã„ã®ã§RAID 0ã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ
updated: 2021-01-21T20:42:57+09:00
---

# è¿½è¨˜(2021-01-21): singleã«æˆ»ã—ã¾ã—ãŸ

singleã«æˆ»ã—ã¾ã—ãŸ.

ãƒ‡ãƒ¼ã‚¿ãŒå¢—ãˆãŸå¾Œ,
å®Ÿéš›ã«ã¯ãƒ‡ãƒã‚¤ã‚¹ç©ºãå®¹é‡ãŒã‚ã‚‹ã«ã‚‚é–¢ã‚ã‚‰ãš,
`no space left on device`
ã¨è¡¨ç¤ºãŒå‡ºã¦ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã—ã¾ã„ã¾ã—ãŸ.

Btrfsã®ã‚µã‚¤ãƒˆãªã©ã‚’è¦‹ãŸã‚Š,
Stack Overflowã‚’è¦‹ãŸã‚Šã™ã‚‹ã¨,
RAID 0ã ã¨å…¨ã¦ã®é ˜åŸŸã‚’ä½¿ã„åˆ‡ã‚Œã‚‹ã¨ã¯é™ã‚‰ãªã„ã¨æ›¸ã‹ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™.

ä½¿ãˆã‚‹å ´åˆã‚‚ã‚ã‚‹ã‚ˆã†ã§ã™ãŒâ€¦

ã‚‚ã—ã‹ã—ãŸã‚‰å®šæœŸçš„ã«`balance`ã‚’å®Ÿè¡Œã™ã‚Œã°å•é¡Œãªã„ã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒ,
ã‚ã‚“ã¾ã‚Šæ‚©ã¾ã•ã‚ŒãŸããªã„ã®ã§singleã«æˆ»ã—ã¾ã—ãŸ.

~~~console
sudo btrfs -v balance start -dconvert=single,soft /
~~~

å…ƒã€…NVMe SSDã¯ãã‚“ãªã«é…ããªã„ã®ã§æ°—ã«ã—ãªã„ã“ã¨ã«ã—ã¾ã™.
æœ¬å½“ã«IOã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æ°—ã«ã™ã‚‹ãªã‚‰åŒã˜å®¹é‡ã§ã¡ã‚ƒã‚“ã¨çµ„ã‚“ã§ã„ãã“ã¨ã«ã—ã¾ã™.

# JBODã ã¨ãƒ‡ãƒ¼ã‚¿ãŒåˆ†æ•£ã•ã‚Œãªã„

[Alienware m17ã«è²·ã„æ›ãˆã¦Gentoo Linuxã‚’Btrfs on dm-cryptã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦NVIDIAã®GPUã‚’æœ‰åŠ¹ã«ã—ã¦èµ·å‹•ã—ã¾ã—ãŸ - ncaq](https://www.ncaq.net/2019/03/19/20/33/08/)
ã§ã¯

~~~console
mkfs.btrfs -L gentoo -d single /dev/mapper/gentoo-0 /dev/mapper/gentoo-1
~~~

ã§[JBOD](https://ja.wikipedia.org/wiki/JBOD)ã§ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ä½œã‚Šã¾ã—ãŸãŒ,
ã“ã‚Œã«ã¯å•é¡ŒãŒã‚ã‚‹ã¨æ„Ÿã˜ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸ.

å•é¡Œã¯`btrfs filesystem usage`ã‚’è¦‹ã‚Œã°ã‚ã‹ã£ã¦,

~~~console
% sudo btrfs filesystem usage /
Overall:
    Device size:		 742.31GiB
    Device allocated:		 138.02GiB
    Device unallocated:		 604.29GiB
    Device missing:		     0.00B
    Used:			 124.13GiB
    Free (estimated):		 615.02GiB	(min: 312.87GiB)
    Data ratio:			      1.00
    Metadata ratio:		      2.00
    Global reserve:		 184.22MiB	(used: 0.00B)

Data,single: Size:132.01GiB, Used:121.28GiB
   /dev/mapper/nvme0n1p2	 132.01GiB

Metadata,RAID1: Size:3.00GiB, Used:1.42GiB
   /dev/mapper/nvme0n1p2	   3.00GiB
   /dev/mapper/nvme1n1p7	   3.00GiB

System,RAID1: Size:8.00MiB, Used:48.00KiB
   /dev/mapper/nvme0n1p2	   8.00MiB
   /dev/mapper/nvme1n1p7	   8.00MiB

Unallocated:
   /dev/mapper/nvme0n1p2	 340.92GiB
   /dev/mapper/nvme1n1p7	 263.37GiB
~~~

ã“ã®æ§˜ã«ãƒ‡ãƒ¼ã‚¿ãŒ1ã¤ã®ãƒ‡ã‚£ã‚¹ã‚¯ã«ã—ã‹ä½œã‚‰ã‚Œã¦ã¾ã›ã‚“.
ç·šå½¢ã«ç¹‹ã„ã§ã„ã£ãŸã®ã§å½“ç„¶ã¨è¨€ãˆã°å½“ç„¶ãªã®ã§ã™ãŒ.

ã“ã‚Œã§ã¯èª­ã¿è¾¼ã¿æ™‚ã«2ã¤ã®ãƒ‡ã‚£ã‚¹ã‚¯ãŒä½¿ã‚ã‚Œãªã„ã‹ã‚‰RAID 0ã«æ¯”ã¹ã¦ä½é€Ÿã§ã™ã­.

ã©ã†ã—ã¦dataã«singleã‚’é¸ã‚“ã ã®ã‹ã¨è¨€ã†ã¨,

> Btrfs ã¯ãƒ‡ã‚£ã‚¹ã‚¯ã«åˆ†æ•£ã—ã¦ãƒ–ãƒ­ãƒƒã‚¯ãƒšã‚¢ã‚’é…ç½®ã™ã‚‹ã®ã«ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³æ–¹å¼ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚Linux 3.0 ã‹ã‚‰, ãƒ–ãƒ­ãƒƒã‚¯ãƒšã‚¢ã‚’åˆ†æ•£ã™ã‚‹éš›ã«å¤§ããªãƒ‡ã‚£ã‚¹ã‚¯ã‚’å„ªå…ˆã™ã‚‹ã‚ˆã†ã« quasi-round-robin æ–¹å¼ãŒä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦è¤‡æ•°ã®ãƒ‡ã‚£ã‚¹ã‚¯ã‹ã‚‰ãƒ‡ã‚£ã‚¹ã‚¯ã‚»ãƒƒãƒˆãŒå‡ºæ¥ã¦ã„ã‚‹ã¨ãã« raid0 ã‚„ raid1 ã§ã»ã¨ã‚“ã© (ã‚‚ã—ãã¯å…¨ã¦) ã®é ˜åŸŸã‚’åŠ¹ç‡çš„ã«åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã£ã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°ã€1å°ã® 1TB ã®ãƒ‡ã‚£ã‚¹ã‚¯ã¨2å°ã® 500GB ã®ãƒ‡ã‚£ã‚¹ã‚¯ã‹ã‚‰ãªã‚‹ã‚»ãƒƒãƒˆã§ data=raid1 ã‚’ä½¿ç”¨ã™ã‚‹ã¨ 1TB ã®ãƒ‡ã‚£ã‚¹ã‚¯ã«ã¯å…¨ã¦ã®ãƒ–ãƒ­ãƒƒã‚¯ã®ã‚³ãƒ”ãƒ¼ãŒã€500GB ã®ãã‚Œãã‚Œã®ãƒ‡ã‚£ã‚¹ã‚¯ã«ã¯ãƒ–ãƒ­ãƒƒã‚¯ãŒäº¤äº’ã« (ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³ã§) é…ç½®ã•ã‚Œã¾ã™ã€‚å®Œå…¨ãªåˆ©ç”¨åŠ¹ç‡ãŒå®Ÿç¾ã•ã‚Œã¾ã™ã€‚1TB ã®ãƒ‡ã‚£ã‚¹ã‚¯ã¨ 750GB ã®ãƒ‡ã‚£ã‚¹ã‚¯ã€500GB ã®ãƒ‡ã‚£ã‚¹ã‚¯ã‹ã‚‰ãªã‚‹ã‚»ãƒƒãƒˆã§ã‚‚åŒã˜ã“ã¨ãŒè¡Œã‚ã‚Œã¾ã™ãŒã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¯ 750GB ã®ãƒ‡ã‚£ã‚¹ã‚¯ã® 250GB ãŒåˆ©ç”¨ã§ããªã„ã“ã¨ã‚’å ±å‘Šã—ã¾ã™ã€‚ã„ã¤ã§ã‚‚å…¨ã¦ã®é ˜åŸŸã‚’æ´»ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã«ã¯ (æœ€å¾Œã«ä¸Šã’ãŸä¾‹ã§ã‚‚)ã€data=single ã‚’ä½¿ã£ã¦ä¸‹ã•ã„ (data=single ã¯ raid ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«ã‚ˆã£ã¦å®šç¾©ã•ã‚Œã‚‹ JBOD ã¨åŒã˜ã§ã™)ã€‚è©³ã—ãã¯ BTRFS FAQ ã‚’å‚ç…§ã€‚
>
> [Btrfs - ArchWiki](https://wiki.archlinux.jp/index.php/Btrfs)

ã‚’èª­ã‚“ã§ã‚µã‚¤ã‚ºãŒé•ã†ãƒ‡ã‚£ã‚¹ã‚¯ã ã¨ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡å…¨ä½“ãŒä½¿ãˆãªã„ã¨æ€ã„è¾¼ã‚“ã ã‹ã‚‰ã§ã™.
ã—ã‹ã—ã“ã‚Œã¯RAID 1ã«é™ã£ãŸè©±ã§RAID 0ã«ã¯é–¢ä¿‚ãªã„ã¨ã„ã†æŒ‡æ‘˜ã‚’å—ã‘ã¾ã—ãŸ.

<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">çµæ§‹èˆˆå‘³ã‚ã£ãŸã®ã§å…¨éƒ¨èª­ã¿ã¾ã—ãŸãƒ¼ï¼ˆä»¥ä¸‹è£œè¶³ï¼‰<br>ãƒ»CBCã«ã¯æ”»æ’ƒæ‰‹æ³•ãŒã‚ã‚Šã€ãã®å¾Œå‡ºãŸæ–°ãƒ¢ãƒ¼ãƒ‰ã®ã†ã¡ã®1ã¤ãŒXTSã€æ”¹ã–ã‚“ã«å¼±ã‚ã ã‘ã©btrfsã¯æ¤œçŸ¥ã—ã¦ãã‚Œã‚‹(è‹±èªç‰ˆã‚¦ã‚£ã‚­ãƒšã‚ˆã‚Š)<br>ãƒ»Btrfsãªã‚‰ç•°ãªã‚‹ã‚µã‚¤ã‚ºã§ã‚‚data=raid0ã§ãã‚‹ã¨æ€ã„ã¾ã™<br>ãƒ»ã‚«ãƒ¼ãƒãƒ«ã§CONFIG_FONTS=Y, FONT_TER16x32=Yã™ã‚‹ã®ã¯å¦‚ä½•</p>&mdash; ãƒªãƒƒã‚­ãƒ¼ (@rikki_312) <a href="https://twitter.com/rikki_312/status/1108665101706354688?ref_src=twsrc%5Etfw">2019å¹´3æœˆ21æ—¥</a></blockquote>

<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">Btrfsã¯quasi-round-robinã‚’æ¡ç”¨ã—ãŸã“ã¨ã¨ã€raid0ã¯stripeæ•°ãŒ1ã€œNã§æ§‹ç¯‰å¯ã¨ãªã£ãŸãŸã‚ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¯ç½®ã„ã¦ãŠã„ã¦ã€ä½¿ãˆã‚‹ã¯ãšã§ã™â€¦â€¦ç¾ã«ã†ã¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒãƒ¼ã¯ã€2.5TBx2+2TBx2ã§RAID10çµ„ã‚“ã§ã¾ã™ãŒå…¨é ˜åŸŸä½¿ãˆã¦ã¾ã™â€¦â€¦ãœã²ãƒˆãƒ©ã‚¤ã—ã¦ã¿ã¦ã»ã—ã„ã¨ã“ã‚ã§ã™â€¦â€¦</p>&mdash; ãƒªãƒƒã‚­ãƒ¼ (@rikki_312) <a href="https://twitter.com/rikki_312/status/1110844972318679040?ref_src=twsrc%5Etfw">2019å¹´3æœˆ27æ—¥</a></blockquote>

# RAID 0ã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ

ã¨ã„ã†ã‚ã‘ã§ã¨ã‚Šã‚ãˆãšæŒ‘æˆ¦ã—ã¦ã¿ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸ.

Btrfsã¯ç´ æ™´ã‚‰ã—ã,
ãªã‚“ã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ãŸå¾Œã§ã‚‚RAIDãƒ¬ãƒ™ãƒ«ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™.

[Using Btrfs with Multiple Devices - btrfs Wiki](https://btrfs.wiki.kernel.org/index.php/Using_Btrfs_with_Multiple_Devices)
ã®Conversionã‚’è¦‹ã¦å¤‰æ›´ã—ã¦ã¿ã¾ã—ã‚‡ã†.

Minimal Installation CDã§èµ·å‹•ã—ã¦mountã—ã¦,

~~~console
# time btrfs balance start -dconvert=raid0 -mconvert=raid1 /mnt/gentoo
Done, had to relocate 137 out of 137 chunks

real	6m30.603s
user	0m0.000s
sys	2m43.887s
~~~

ã§dataã‚’raid0ã«ã—ã¾ã—ãŸ.

ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¯å¤§äº‹ãªã®ã§raid1ã®ã¾ã¾ã§ã™,
ãƒ‡ãƒ¼ã‚¿é‡ã‚‚å¤šããªã„ã§ã™ã—å¤šåˆ†å•é¡Œãªã„ã§ã—ã‚‡ã†.

ãƒ‡ãƒ¼ã‚¿ã®ã»ã¼åŠåˆ†ã‚’ç§»ã—æ›¿ãˆã‚‹ã®ã§åŠæ—¥ãã‚‰ã„ã‹ã‚‰ã‚‹ã‹ãªã¨è¦šæ‚Ÿã—ã¦å¤œå®Ÿè¡Œã—ãŸã®ã§ã™ãŒ,
ãŸã£ãŸã®6åˆ†ã§çµ‚ã‚ã£ãŸã®ã§è‚©é€ã‹ã—ã§ã—ãŸã­â€¦

ãã‚Œã§å®Ÿéš›ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã§ãã‚‹é‡ãŒã©ã†å¤‰åŒ–ã—ãŸã®ã‹.

singleçŠ¶æ…‹ã®æ™‚ã¯

~~~console
% 2019-03-27T21:31:28 ncaq@indigo/pts/1(0) ~/GoogleDrive
% sudo btrfs filesystem show
Label: 'gentoo'  uuid: a0bb3fae-c511-454b-92d9-5ea5c3c4558d
        Total devices 2 FS bytes used 122.71GiB
        devid    1 size 475.94GiB used 135.02GiB path /dev/mapper/nvme0n1p2
        devid    2 size 266.37GiB used 3.01GiB path /dev/mapper/nvme1n1p7

% 2019-03-27T21:31:35 ncaq@indigo/pts/1(0) ~/GoogleDrive
% sudo btrfs filesystem df /
Data, single: total=132.01GiB, used=121.28GiB
System, RAID1: total=8.00MiB, used=48.00KiB
Metadata, RAID1: total=3.00GiB, used=1.42GiB
GlobalReserve, single: total=184.22MiB, used=0.00B
% 2019-03-27T21:31:45 ncaq@indigo/pts/1(0) ~/GoogleDrive
% sudo btrfs filesystem usage /
Overall:
    Device size:                 742.31GiB
    Device allocated:            138.02GiB
    Device unallocated:          604.29GiB
    Device missing:                  0.00B
    Used:                        124.13GiB
    Free (estimated):            615.02GiB      (min: 312.87GiB)
    Data ratio:                       1.00
    Metadata ratio:                   2.00
    Global reserve:              184.22MiB      (used: 0.00B)

Data,single: Size:132.01GiB, Used:121.28GiB
   /dev/mapper/nvme0n1p2         132.01GiB

Metadata,RAID1: Size:3.00GiB, Used:1.42GiB
   /dev/mapper/nvme0n1p2           3.00GiB
   /dev/mapper/nvme1n1p7           3.00GiB

System,RAID1: Size:8.00MiB, Used:48.00KiB
   /dev/mapper/nvme0n1p2           8.00MiB
   /dev/mapper/nvme1n1p7           8.00MiB

Unallocated:
   /dev/mapper/nvme0n1p2         340.92GiB
   /dev/mapper/nvme1n1p7         263.37GiB
~~~

ã§raid1ã«å¤‰ãˆãŸã‚‰

~~~console
% 2019-03-27T21:52:54 ncaq@indigo/pts/2(0) ~/GoogleDrive
% sudo btrfs filesystem show
Label: 'gentoo'  uuid: a0bb3fae-c511-454b-92d9-5ea5c3c4558d
        Total devices 2 FS bytes used 122.75GiB
        devid    1 size 475.94GiB used 63.03GiB path /dev/mapper/nvme1n1p2
        devid    2 size 266.37GiB used 63.03GiB path /dev/mapper/nvme0n1p7

% 2019-03-27T21:53:09 ncaq@indigo/pts/2(0) ~/GoogleDrive
% sudo btrfs filesystem df /
Data, RAID0: total=122.00GiB, used=121.30GiB
System, RAID1: total=32.00MiB, used=16.00KiB
Metadata, RAID1: total=2.00GiB, used=1.45GiB
GlobalReserve, single: total=206.72MiB, used=0.00B
% 2019-03-27T21:53:23 ncaq@indigo/pts/2(0) ~/GoogleDrive
% sudo btrfs filesystem usage /
Overall:
    Device size:                 742.31GiB
    Device allocated:            126.06GiB
    Device unallocated:          616.25GiB
    Device missing:                  0.00B
    Used:                        124.22GiB
    Free (estimated):            616.92GiB      (min: 308.80GiB)
    Data ratio:                       1.00
    Metadata ratio:                   2.00
    Global reserve:              206.73MiB      (used: 0.00B)

Data,RAID0: Size:122.00GiB, Used:121.32GiB
   /dev/mapper/nvme0n1p7          61.00GiB
   /dev/mapper/nvme1n1p2          61.00GiB

Metadata,RAID1: Size:2.00GiB, Used:1.45GiB
   /dev/mapper/nvme0n1p7           2.00GiB
   /dev/mapper/nvme1n1p2           2.00GiB

System,RAID1: Size:32.00MiB, Used:16.00KiB
   /dev/mapper/nvme0n1p7          32.00MiB
   /dev/mapper/nvme1n1p2          32.00MiB

Unallocated:
   /dev/mapper/nvme0n1p7         203.34GiB
   /dev/mapper/nvme1n1p2         412.91GiB
~~~

ã«ãªã£ãŸã®ã§raid1ã«ã—ã¦ã‚‚ãƒ‡ãƒã‚¤ã‚¹ã®ã‚µã‚¤ã‚ºã¯å…¨ãå¤‰ã‚ã‚Šã¾ã›ã‚“.
è‰¯ã‹ã£ãŸã§ã™ã­.

æœ¬å½“ã«æ—©ããªã£ãŸã®ã‹ã¯ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å–ã£ã¦ãªã„ã‹ã‚‰çŸ¥ã‚Šã¾ã›ã‚“.
ãã“ã¾ã§ã‚„ã‚‹æ°—ãŒãªã„.

ã¨ã„ã†ã‹
[btrfs-thin-book/usage.md at master Â· satoru-takeuchi/btrfs-thin-book](https://github.com/satoru-takeuchi/btrfs-thin-book/blob/master/usage.md)
ã«ã‚ˆã‚‹ã¨`mkfs.btrfs`æ™‚ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ãªã‘ã‚Œã°ãƒ‡ãƒ¼ã‚¿ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§raid0ãŒé¸æŠã•ã‚Œã‚‹ã‚ˆã†ã§ã™ã­.
ä½™è¨ˆãªã“ã¨ã‚’ã—ãªã‘ã‚Œã°è‰¯ã‹ã£ãŸ.

# RAID 1ã«ã™ã‚‹ã¨swapfileã¯å‹•ãã¾ã›ã‚“

å†èµ·å‹•ã—ã¦æ°—ãŒã¤ã„ãŸã®ã§ã™ãŒswapfileãŒå‹•ãã¾ã›ã‚“.

<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">man 5 btrfs ã«ã‚ˆã‚Œã°ã€<br><br>* filesystem - must be only single device<br>* swapfile - the containing subvolume cannot be snapshotted<br>* swapfile - must be preallocated<br>* swapfile - must be nodatacow (ie. also nodatasum)<br>* swapfile - must not be compressed<br><br>ã¨ã®ã“ã¨ã§</p>&mdash; ã‚‰ã‚ŠãŠãƒ»ã‚¶ãƒ»ä½•ã‚‰ã‹ã®ğŸˆ—ç„¶ãŠŒã‹ã‹°ã‹·ã‹“ (Mastodon ã«å¼•ã£è¶Šã—ã¾ã—ãŸ) (@lo48576) <a href="https://twitter.com/lo48576/status/1110890566944874496?ref_src=twsrc%5Etfw">2019å¹´3æœˆ27æ—¥</a></blockquote>

<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">ã‚‚ã†ã”å­˜çŸ¥ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒâ€¦â€¦<br>ãƒ»btrfs balance status /mountpoint<a href="https://t.co/KjlQzHNz4l">https://t.co/KjlQzHNz4l</a><br>ãƒ»Swapfile support (Limitation)<a href="https://t.co/sMOGFlLxRY">https://t.co/sMOGFlLxRY</a></p>&mdash; ãƒªãƒƒã‚­ãƒ¼ (@rikki_312) <a href="https://twitter.com/rikki_312/status/1110899414296494080?ref_src=twsrc%5Etfw">2019å¹´3æœˆ27æ—¥</a></blockquote>

manã‹ã‚‰å¼•ç”¨ã™ã‚‹ã¨(wikiãŒæ›´æ–°ã•ã‚Œã¦ãªã„ã‹ã‚‰ãƒªãƒ³ã‚¯è²¼ã‚‹å…ˆãŒè¦‹ã¤ã‹ã‚‰ãªã„)

> SWAPFILE SUPPORT
>
> The swapfile is supported since kernel 5.0. Use swapon(8) to activate the swapfile. There are some limitations of the implementation in btrfs and linux swap subystem:
>
> +
>   * filesystem - must be only single device
>   * swapfile - the containing subvolume cannot be snapshotted
>   * swapfile - must be preallocated
>   * swapfile - must be nodatacow (ie. also nodatasum)
>   * swapfile - must not be compressed
>
> + The limitations come namely from the COW-based design and mapping layer of blocks that allows the advanced features like relocation and multi-device filesystems. However, the swap subsystem expects simpler mapping and no background changes of the file
> blocks once theyâ€™ve been attached to swap.
>
> + With active swapfiles, the following whole-filesystem operations will skip swapfile extents or may fail:
>   * balance - block groups with swapfile extents are skipped and reported, the rest will be processed normally
>   * resize grow - unaffected
>   * resize shrink
> - works as long as the extents are outside of the shrunk range
>   * device add - a new device does not interfere with existing swapfile and this operation will work, though no new swapfile can be activated afterwards
>   * device delete - if the device has been
> added as above, it can be also deleted
> * device replace - dtto
>
> + When there are no active swapfiles and a whole-filesystem exclusive operation is running (ie. balance, device delete, shrink), the swapfiles cannot be temporarily activated. The operation must finish first.
>
> ```
> # truncate -s 0 swapfile
> # chattr +C swapfile
> # fallocate -l 2G swapfile
> # chmod 0600 swapfile
> # mkswap swapfile
> # swapon swapfile
> ```

(ã¨ã„ã†ã‹ã“ã®ã‚³ãƒ¼ãƒ‰ä¾‹ã ã¨åœ§ç¸®ã—ãªã„ã¨ã„ã†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’`chattr`ã§ä»˜ã‘ã¦ãªã„ã‘ã©è‰¯ã„ã‚“ã ã‚ã†ã‹)

ã¨ã„ã†ã‚ã‘ã§å°‘ãªãã¨ã‚‚Linux 5.0ã§ã¯Btrfsã®swapfileã¯ã‚·ãƒ³ã‚°ãƒ«ãƒ‡ãƒã‚¤ã‚¹ã«ç½®ã‹ãªã„ã¨ä½¿ãˆãªã„ã‚ˆã†ã§ã™.
chattrã§ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚·ãƒ³ã‚°ãƒ«ã«ç½®ã„ã¦ã¨ã‹æŒ‡ç¤ºã™ã‚‹ã“ã¨ã‚‚èª¿ã¹ã¾ã—ãŸãŒå‡ºæ¥ãªã„ã‚ˆã†ã§ã™.
æ®‹å¿µ.

å°†æ¥çš„ã«ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹å¯èƒ½æ€§ã¯ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒä»Šã®æ‰€ãã®å‹•ãã¯ã‚­ãƒ£ãƒƒãƒã—ã¦ãªã„ã§ã™ã­.

ã¾ã‚ã“ã®RAID 0ã™ã‚‹Alienware m17ã¯è«–ç†ã‚¹ãƒ¬ãƒƒãƒ‰æ•°12ã§ãƒ¡ãƒ¢ãƒª32GBç©ã‚“ã§ã„ã‚‹ã®ã§,
ã‚¹ãƒ¯ãƒƒãƒ—ãŒä¸€åˆ‡ç„¡ãã¦ã‚‚å•é¡ŒãŒèµ·ãã‚‹ã“ã¨ç„¡ã„ã¨æ€ã„ã¾ã™.
ãªã®ã§ã‚¹ãƒ¯ãƒƒãƒ—ã¯è«¦ã‚ã‚‹ã“ã¨ã«ã—ã¾ã™.

ä¸€å¿œzramãã‚‰ã„ã¯æœ‰åŠ¹ã«ã—ã¦ãŠãã“ã¨ã«ã—ã¾ã™ãŒ.
[zram - Gentoo Wiki](https://wiki.gentoo.org/wiki/Zram)

ã‚¹ãƒ¯ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã„ãŸã„ã¨ã„ã†äººã¯æ°—ã‚’ã¤ã‘ã¾ã—ã‚‡ã†.
