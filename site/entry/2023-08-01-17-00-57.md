---
title: DeepLなどに英文を入力する時のために、word wrap的なレイアウトのための改行を消し、本当に改行したそうな場合は残すスクリプト
---

# 問題

[emacs/etc/NEWS.29 at master · emacs-mirror/emacs](https://github.com/emacs-mirror/emacs/blob/master/etc/NEWS.29)
のような古式ゆかしいUNIX仕草として、
幅を80文字ぐらいに留めておくというものがあります。

その結果、
soft wrapとかword wrapとか言われる、
スペースの変わりに改行を挿入することが行われます。
英文的には改行もスペースと見做せば意味は変わらないため、
これで意味を損なわずに改行が出来るわけですね。

しかし、
[DeepL](https://www.deepl.com/translator)などの翻訳ツールは改行を一区切りとして認識してしまうことが多いため、
そういったものに入力する時に問題となります。

[Firefox向けDeepLブラウザ拡張でC-'にショートカットキーを割り当てたかったのですが失敗しました - ncaq](https://www.ncaq.net/2023/07/31/04/16/38/)
で書いたようにFirefox向けのDeepL拡張がリリースされたので、
一ヶ月DeepL Proをお試し契約してみることにしました。
そこでDeepLを使い倒すための問題は倒してみることにします。

# 既存の解決策の問題

もちろんこれは認識されていて既存の解決策があります。

* [Shaper | 論文翻訳支援アプリ](https://dream-exp.net/shaper/)
* [DeepLで翻訳するときに改行を消す - かすみん日記](https://geniusium.hatenablog.com/entry/2021/02/20/152138)
* [余計な改行を削除してDeepL翻訳するブックマークレット | 情報の海を泳ぐ](https://pajoca.com/deepl-bookmarklet-remove-linefeed/)

ただしこれらはシンプルに全ての改行を消してしまいます。

そうすると1行がとても長くなってしまいます。

それはそれで読みにくいし、
元の文章との対応が分かりにくくなってしまうと言った問題があります。

# 解決実装

なので必要そうな改行は残すスクリプトを書いてみました。

<script src="https://gist.github.com/ncaq/71f2b262462b904795c10b75a259114f.js"></script>

~~~console
cat NEWS.29.txt|python3 remove_newline_for_wrap.py > NEWS.29.trim.txt
~~~

のような感じで実行してください。

実装は簡単です。
改行のみや末尾が単語を構成する文字ではない場合は残すだけです。

# TypeScriptで実装するべきでした

何故私が好きでもないPythonで実装しているのかというと、
最初はChatGPTのCode Interpreterでテキストを処理して改行を消そうと思ったからです。

なのでその流れでPythonで実装したわけですが、
あまりにもポンコツ過ぎたので、
結局自分がほぼゼロから実装することになりました。

これならTypeScriptで実装してJavaScriptに変換してSurfingkeysに載せてDeepLを開く時に変換できるようにするべきでした。
まあ実装は単純なのでそのうちTypeScriptバージョンも書きます。
