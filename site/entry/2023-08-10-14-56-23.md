---
title: GitHub issueを単一のMarkdownとしてexportする方法
---

# 問題

最近[GitHub issue](https://docs.github.com/ja/issues)でTODO管理とかしたり、
[Zennのスクラップ](https://zenn.dev/zenn/articles/about-zenn-scraps)のように時系列だけで考えをまとめずにメモることが多いです。

しかしGitHub issueはそのままだとテキストデータとして扱いにくいです。
記事化したりDeepLに翻訳させるときに問題になります。

ちなみに[DeepLのブラウザ拡張機能](https://www.deepl.com/ja/firefox-extension)の、
[DeepL Pro](https://www.deepl.com/ja/pro/)特典のページ全体の翻訳はGitHub issueではうまく動きません。
というかページ全体翻訳がきちんと動くページの方が少ないと思うんですが、
これは自分の環境の組み合わせが悪いんでしょうか?

そこで[GitHub CLI](https://cli.github.com/)に適切な[jq](https://jqlang.github.io/jq/)のクエリを渡すことで、
単一のMarkdown形式でエクスポート出来るコマンドを使っています。

[アカウントごとのGitHub Projectsを使った公開TODO管理が割と良い感じ · Issue #145 · ncaq/www.ncaq.net](https://github.com/ncaq/www.ncaq.net/issues/145)を見る限り2023年3月に作ってるみたいですね。

## 自分への疑問: Zennを使えば良いのでは?

私は今は[Qiita](https://qiita.com/)とか[Zenn](https://zenn.dev/)とか、
独自ドメインでの[はてなブログ](https://hatenablog.com/)すら使っていません。

このサイトはMarkdownから[hakyll](https://hackage.haskell.org/package/hakyll)とその内部の[pandoc](https://hackage.haskell.org/package/pandoc)を使って、
HTMLとして出力して[Cloudflare Pages](https://pages.cloudflare.com/)でホスティングしています。
Cloudflare Pagesにすら大して依存していなくて単純にHTMLなどを配信しているだけなので、
いつでも自宅サーバの[NGINX](https://www.nginx.co.jp/)を使ったホスティングに戻すことが可能です。
今では珍しくなってしまったHTMLレベルで管理するwebページを提供しているのは、
自分のデータはなるべく自分でコントロールしたいという思想から発生しているものです。

Qiitaが信用できなくなったからZennやはてなブログに記事を移動させたとかいうページを見るたびに、
Zennが今後Qiitaのようにならないと思う確信はどこから来るんだろうなと思います。

確かにQiitaのやらかしは擁護できないものですが。

* [Qiita、読んだ記事の傾向を合意無しに表示して炎上　批判受け機能停止中 - ITmedia NEWS](https://www.itmedia.co.jp/news/articles/2003/26/news087.html)
* [「さくらのレンタルサーバ」批判記事、Qiitaで公開止められ炎上　さくらは「事実確認中」 - ITmedia NEWS](https://www.itmedia.co.jp/news/articles/1912/26/news121.html)

しかし今回これはGitHubにデータを保存して使っているので既にGitHubに依存してしまっています。
それならZennのスクラップを使っても良かったのではないかと少し思いました。
依存先を減らすのは意味があるかもしれませんが。

# 単純な`gh issue view`だと微妙なフォーマットをかけられてしまいます

例えば、
[GitHub Sponsorsに登録できなかった話 · Issue #133 · ncaq/www.ncaq.net](https://github.com/ncaq/www.ncaq.net/issues/133)を閲覧してみます。

ちなみにこのissueは、
[Stripe Connectに対応している日本の銀行一覧が未だに記載されていないため調べました - ncaq](https://www.ncaq.net/2023/08/02/00/07/50/)
として既に記事化しています。

~~~console
2023-08-10T14:59:37 ⬢ [Systemd] ❯ gh issue view https://github.com/ncaq/www.ncaq.net/issues/133 --comments
GitHub Sponsorsに登録できなかった話 #133
Closed • ncaq opened about 5 months ago • 7 comments
Labels: Type: Documentation



  • 銀行の問題
  • 他の人は受け取れるって言ってる
  • Stripe側もちゃんと対応銀行を把握していない


ncaq (Owner) • 8d

  楽天銀行とゆうちょ銀行はTwitter Blueの広告収益配分にも対応していない

View the full review: https://github.com/ncaq/www.ncaq.net/issues/133#issuecomment-1660459959
~~~

Markdown形式で記事化したりDeepLに投げ込むにはこれでは不向きですね。
余計なメタデータが多すぎることと、
せっかく元がMarkdown形式であるにも関わらず中途半端にフォーマットされてしまっています。

`--template`フラグを使って制御しようかとも思いましたが、
どちらかと言うとこれはメタデータをフォーマットするためのフラグであることと、
Markdown文法に対して一つずつ対応させるのが面倒です。
元がMarkdown形式なので生の情報を取れれば十分なわけです。

`--json`フラグでJSON形式でほぼ生のデータを取れて、
`jq`のコマンドを使ってフォーマット出来るようなので、
その方針で実装しました。

# `gh-issue-export`コマンド

`gh-issue-export`コマンドとして置いています。

~~~zsh
#!/bin/zsh
set -eu

gh issue view $@ --comments --json body --jq '.body' --json comments --jq '.body, .comments.[].body|., "\n---\n"'|tr -d '\r'
~~~

`--json`と`--jq`で本文とコメントとその本文を全て取得して、
そのままだと投稿間の区切りが分かりにくいため、
`---`で投稿を区切るようにしています。
また改行がCRLF形式になってしまう部分があるため`tr`コマンドでCR部分を除去しています。

クリップボードにコピーしたい時は以下の[XSel](https://vergenet.net/~conrad/software/xsel/)を使った、
`to-clipboard`エイリアスにパイプで流し込みます。

~~~zsh
alias to-clipboard='xsel --logfile /dev/null --input --clipboard'
~~~
